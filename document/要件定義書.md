# 要件定義書：天気時系列チャート SPA

## 1. 概要

### 1.1 プロジェクト名
天気時系列情報表示 SPA（Single Page Application）

### 1.2 目的
都市と指標を選択し、Open-Meteo Forecast API から取得した時系列の天気情報をチャートで表示する 1 ページ完結の Web アプリケーションを構築する。

### 1.3 基本方針
- **UI**: セレクトボックス・トグル・チェックボックス等の選択式のみで完結
- **例**: 都市＝「東京」、指標＝「気温」、期間＝「7日間」→ 折れ線グラフを描画

---

## 2. 機能要件

### 2.1 データ取得

| 項目 | 内容 |
|------|------|
| データソース | Open-Meteo Forecast API（API キー不要・非商利用無料） |
| 取得方法 | 緯度・経度と取得したい指標を指定し、JSON の時系列予報を取得 |
| 都市 | あらかじめ用意した候補から選択（例：東京・大阪・札幌・福岡・那覇） |
| 都市と座標 | 選択した都市に対応する lat/lon を内部で参照して API をコール |

**参考**: [Open-Meteo](https://open-meteo.com/)

### 2.2 表示指標

| 種別 | 指標（パラメータ名） | 説明 |
|------|----------------------|------|
| hourly | temperature_2m | 気温 |
| hourly | apparent_temperature | 体感温度 |
| hourly | precipitation | 降水量 |
| hourly | windspeed_10m | 風速 |
| daily | temperature_2m_max / temperature_2m_min | 日最高・最低気温 |

**API パラメータ**:
- `forecast_days=7` まで
- `timezone=auto` 等の単位・タイムゾーンパラメータを適宜設定

### 2.3 期間切り替え

| 項目 | 内容 |
|------|------|
| 実装方法 | トグルで切り替え |
| 48時間 | hourly データで表示 |
| 7日間 | daily または hourly 集計で表示 |

### 2.4 チャート

| 項目 | 内容 |
|------|------|
| 形式 | 折れ線（必要に応じスプライン） |
| 必須要素 | ツールチップ、凡例、Y 軸単位、X 軸（時刻/日付）フォーマット |

### 2.5 UX 要件

| 項目 | 内容 |
|------|------|
| ローディング | プレースホルダまたはスピナーを表示 |
| エラー時 | ネットワーク・パラメータ不正・レート制限等に対し、復帰手段を伴うメッセージを表示 |

**Open-Meteo レート制限（目安）**: 日 1 万 / 時 5 千 / 分 600 リクエスト。過剰アクセスを避ける（デバウンス・キャッシュの検討）。

### 2.6 アクセシビリティ

- セレクト・トグルに適切な `label` を付与
- モーダル使用時のフォーカストラップ等、基本を遵守

### 2.7 パフォーマンス

- 選択変更時のみフェッチする
- 重い再描画を避ける（メモ化、SWR / React Query 等のキャッシュは任意）

---

## 3. 任意拡張（オプション）

| 機能 | 説明 |
|------|------|
| 指標の複数選択 | 多系列の重ね描き |
| 単位切替 | °C / °F、風速単位の切替 |
| 直近選択の保持 | localStorage で保持 |
| その他 | オリジナリティのある実装も可 |

---

## 4. 制約条件

### 4.1 技術制約

| 項目 | 内容 |
|------|------|
| フレームワーク | React または Next.js（最新版推奨、TypeScript 推奨） |
| ページ構成 | 1 ページで完結。モーダル・タブ・アコーディオン等のページ内変化は可 |
| データソース | Open-Meteo Forecast API（必要に応じ Geocoding API） |
| チャート | 任意ライブラリ（Recharts / Chart.js 等）で選定可 |
| ブラウザ | Google Chrome 最新版で正しく動作すること |

### 4.2 利用条件

- API キー不要・非商利用の無償利用可
- レート制限および帰属表記に関するポリシーを遵守
- 商用的に公開・運用する場合はプラン・利用条件を要確認

---

## 5. 成果物・提出

| 項目 | 内容 |
|------|------|
| リポジトリ | GitHub 等の URL |
| README | 起動手順・技術選定理由・ディレクトリ構成・工夫点・既知の制約 |
| デモ URL | 任意（Vercel 等。Basic 認証等を推奨） |

---

## 6. 採点観点（実装のポイント）

| 観点 | 内容 |
|------|------|
| 設計 | コンポーネント分割・責務分離、状態設計、データフローの明快さ |
| コーディング | セマンティックなコーディング、非同期・エラー処理、ローディング・空状態の網羅、型安全性、リンター・フォーマッターの設定・利用 |
| 技術選定 | チャート・データ取得・日付処理等のライブラリ選定理由と使いこなし |
| UI/UX | 操作性（切替の即時性、ツールチップ等）、視認性、レスポンシブ |
| パフォーマンス | 無駄な再フェッチ・再描画の抑制、キャッシュやメモ化の適用 |

---

## 7. 用語・参照

- **Open-Meteo**: https://open-meteo.com/
- **Forecast API**: 緯度・経度とパラメータで時系列天気予報を取得
- **Geocoding API**: 必要に応じて都市名から緯度・経度を取得する場合に利用可能
