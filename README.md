# 天気時系列チャート（tamable）

都市・指標・期間を選び、Open-Meteo の天気予報を時系列チャートで表示する SPA です。

---

## 【提出】対応一覧

| 項目 | 内容 |
|------|------|
| リポジトリURL | https://github.com/harukikbb8-max/tamable-weather-app-1 |
| README | 本ファイル（起動手順 / 技術選定理由 / ディレクトリ構成 / 工夫点 / 既知の制約） |
| デモURL | https://tamable-weather-app-1.vercel.app |

---

## 起動手順

**重要**: ブラウザで開く前に、必ずターミナルでサーバーを起動してください。

### 手順

1. ターミナルを開く
2. プロジェクトのディレクトリに移動し、次を実行：

```bash
cd <プロジェクトのディレクトリ>
npm install
npm run open
```

3. **「Serving!」** または **「Local: http://localhost:3000」** と表示されるまで待つ
4. ブラウザで次のいずれかを開く：
   - **http://127.0.0.1:3000**
   - **http://localhost:3000**

※ 終了時はターミナルで **Ctrl + C** を押す。

### 開発サーバーで起動する場合

```bash
npm install
npm run dev
```

**「✓ Ready」** 表示後、ブラウザで **http://127.0.0.1:3000** を開く。

---

## 技術選定理由

| 技術 | 選定理由 |
|------|----------|
| **Next.js (App Router)** | React ベースで SPA を構築しやすく、静的エクスポート（`output: 'export'`）でビルド成果物をそのまま配布・プレビュー可能にするため。 |
| **TypeScript** | 型で API レスポンスや指標 ID を担保し、保守性と安全性を高めるため。 |
| **Tailwind CSS** | ユーティリティファーストで、看板風デザインやレスポンシブを少ない記述で実装するため。 |
| **Recharts** | 折れ線グラフ・凡例・ツールチップが揃っており、アクセシブルなチャートを短期間で実装するため。 |
| **Open-Meteo API** | API キー不要・無料で、hourly/daily の天気予報を取得できるため。 |

---

## ディレクトリ構成

```
tamable/
├── app/                    # Next.js App Router
│   ├── globals.css         # 全体スタイル・CSS変数（看板/カード/チャート）
│   ├── layout.tsx          # ルートレイアウト・メタデータ・フォント
│   └── page.tsx            # メインページ（状態・API取得・チャート表示）
├── components/             # UI コンポーネント
│   ├── CitySelect.tsx     # 都市セレクト
│   ├── ErrorMessage.tsx    # エラー表示・再試行ボタン
│   ├── LoadingSpinner.tsx  # 読み込み表示
│   ├── MetricMultiSelect.tsx  # 指標（複数選択）チェックボックス
│   ├── PeriodToggle.tsx   # 48時間 / 7日間トグル
│   ├── StartDateDisplay.tsx   # 表示開始日（今日）表示
│   ├── UnitToggles.tsx     # 気温・風速の単位トグル（指標に応じて有効/無効）
│   └── WeatherChart.tsx   # 折れ線グラフ（Recharts）
├── lib/                    # ロジック・API・変換
│   ├── api.ts              # Open-Meteo フェッチ・キャッシュ・タイムアウト
│   ├── chartConvert.ts     # 単位変換（°C/°F, km/h/m/s）適用
│   ├── constants.ts       # 都市・指標・期間・単位の定義
│   ├── dates.ts            # 日付ユーティリティ（JST・開始日）
│   ├── storage.ts          # 選択状態のローカルストレージ保存
│   ├── transform.ts       # API レスポンス → チャート用データ（単一/複数指標）
│   ├── types.ts            # API・チャートの型定義
│   └── units.ts            # 気温・風速の換算
├── document/               # ドキュメント
│   ├── 要件定義書.md
│   └── タスク管理シート.md
├── public/                 # 静的アセット
├── next.config.ts          # 静的エクスポート設定
├── package.json
└── README.md               # 本ファイル
```

---

## 工夫点

- **複数指標の同時表示**: 気温・体感温度・降水量・風速をチェックボックスで複数選択し、1 本のグラフに重ねて表示。7 日間では「気温」は日最高/最低、「体感温度」は hourly の日別サンプルで time を "YYYY-MM-DD" に統一し、正しくマージして表示。
- **単位トグルの有効/無効**: 選択中の指標に応じて「気温（°C/°F）」は気温・体感温度選択時のみ、「風速（km/h/m/s）」は風速選択時のみ操作可能にし、無効時は理由を短く表示。
- **選択状態の保持**: 都市・指標・期間・単位を `localStorage` に保存し、再訪問時も前回の選択を復元。
- **API まわりの安定化**: フェッチに 10 秒タイムアウト、ローディングは最大 12 秒で解除し、二重リクエストによる状態不整合を避けるロード ID 管理。
- **UI/デザイン**: ヘッダーを看板風（ネイビー＋ゴールド・影・枠）、メインを掲示板風のカードで統一。チャートはライトテーマで軸・グリッド・ツールチップを揃え、48 時間は 1 時間ごとにドット表示。
- **アクセシビリティ**: フォームにラベル・aria-label、エラーに role="alert"、チャートに role="img" と aria-label を付与。

---

## 既知の制約

- **表示開始日**: 「今日（現在から）」のみ。過去日や任意の開始日には未対応（Open-Meteo の仕様に合わせている）。
- **7 日間の体感温度**: API に daily の体感温度がないため、hourly の「日ごと先頭時刻」の値を 1 日 1 点として表示。日平均などは未実装。
- **オフライン**: API はオンライン必須。オフライン時はエラー表示と再試行で対応。
- **ビルド時のフォント**: `next build` で Google Fonts（Geist）を取得するため、ネットワークが必要。オフライン環境ではビルドが失敗する場合あり。
- **デモ公開時**: デモ URL を公開する場合は、Basic 認証等の認証をかけることを推奨。

---

## その他

- 要件・タスクの詳細は `document/要件定義書.md` および `document/タスク管理シート.md` を参照。
